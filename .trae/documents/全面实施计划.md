# TQLSlib 模组全面实施计划

## 文档信息
- **项目名称**：TQLSlib 模组架构重构与功能扩展
- **文档版本**：v1.0
- **创建日期**：2026-02-15
- **制定人**：架构规划团队
- **实施周期**：6 周（42 天）

---

## 一、项目概述

### 1.1 项目目标
基于已制定的架构规划文档，完成 TQLSlib 模组的架构重构与功能扩展，实现：
- ✅ 符合 SOLID 原则的代码架构
- ✅ 提供完整的 API 层供其他模组调用
- ✅ 支持 JSON 配置系统
- ✅ 实现事件总线系统
- ✅ 统一的内容注册表
- ✅ 完整的文档与示例

### 1.2 项目范围
- **包含**：架构重构、API 层、事件系统、配置系统、内容注册表、文档
- **不包含**：完全重写现有功能（仅重构优化）、新增与核心功能无关的业务逻辑

### 1.3 关键成功因素
1. 严格按照架构规划执行
2. 保持向后兼容性
3. 充分的测试覆盖
4. 清晰的文档

---

## 二、详细实施步骤

### 阶段 1：架构基础与重构（第 1 周，P0）

#### 1.1 准备工作（第 1 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.1.1 | 创建 Git 分支 `feature/architecture-refactor` | 开发 | 0.5h | - |
| 1.1.2 | 备份当前代码到安全位置 | 开发 | 0.5h | - |
| 1.1.3 | 确认开发环境配置正确 | 开发 | 0.5h | - |
| 1.1.4 | 编译当前代码，确保无错误 | 开发 | 0.5h | - |

**交付物**：Git 分支、备份代码、编译通过的当前版本

---

#### 1.2 创建 API 包和接口（第 2 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.2.1 | 创建 `tqlslib/api` 目录结构 | 开发 | 0.5h | 1.1 |
| 1.2.2 | 创建 `SpaceStationAPI.java` 接口 | 开发 | 1.5h | 1.2.1 |
| 1.2.3 | 创建 `ContentRegistry.java` 接口 | 开发 | 1.0h | 1.2.1 |
| 1.2.4 | 创建 `EventBus.java` 接口 | 开发 | 1.0h | 1.2.1 |
| 1.2.5 | 编写接口 Javadoc 文档 | 开发 | 1.0h | 1.2.2-1.2.4 |

**交付物**：api 包、3 个接口定义、Javadoc 文档

---

#### 1.3 工具类重构（第 3 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.3.1 | 分析 `TQUtls.java` 当前内容 | 开发 | 1.0h | 1.1 |
| 1.3.2 | 创建 `TQUtils.java`（修正拼写） | 开发 | 0.5h | 1.3.1 |
| 1.3.3 | 迁移通用工具方法到 `TQUtils` | 开发 | 1.5h | 1.3.2 |
| 1.3.4 | 创建 `TimeUtils.java` | 开发 | 0.5h | 1.3.1 |
| 1.3.5 | 迁移时间相关方法到 `TimeUtils` | 开发 | 1.0h | 1.3.4 |
| 1.3.6 | 更新所有引用，从 `TQUtls` 改为 `TQUtils` | 开发 | 1.0h | 1.3.3, 1.3.5 |
| 1.3.7 | 标记 `TQUtls.java` 为 `@Deprecated` | 开发 | 0.5h | 1.3.6 |

**交付物**：`TQUtils.java`、`TimeUtils.java`、重构后的工具类

---

#### 1.4 空间站系统重构（第 4-5 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.4.1 | 创建 `SpaceStationCore.java` | 开发 | 0.5h | 1.2 |
| 1.4.2 | 从 `SpaceStationManager` 提取核心逻辑到 `SpaceStationCore` | 开发 | 3.0h | 1.4.1 |
| 1.4.3 | 让 `SpaceStationCore` 实现 `SpaceStationAPI` 接口 | 开发 | 1.0h | 1.4.2 |
| 1.4.4 | 重构 `SpaceStationManager` 为门面模式，代理到 `SpaceStationCore` | 开发 | 2.0h | 1.4.3 |
| 1.4.5 | 创建 `ContentRegistryCore.java` | 开发 | 1.0h | 1.2 |
| 1.4.6 | 实现 `ContentRegistryCore` 的所有方法 | 开发 | 1.5h | 1.4.5 |
| 1.4.7 | 编译并修复所有编译错误 | 开发 | 2.0h | 1.4.4, 1.4.6 |

**交付物**：`SpaceStationCore.java`、`ContentRegistryCore.java`、重构后的 `SpaceStationManager.java`

---

#### 1.5 更新主入口类（第 6 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.5.1 | 更新 `TQLSlib.java`，使用新的架构 | 开发 | 2.0h | 1.4 |
| 1.5.2 | 将内容注册逻辑迁移到 `ContentRegistryCore` | 开发 | 1.0h | 1.5.1 |
| 1.5.3 | 编译并修复所有编译错误 | 开发 | 1.5h | 1.5.2 |
| 1.5.4 | 运行模组，验证所有现有功能 | 测试 | 2.0h | 1.5.3 |
| 1.5.5 | 修复发现的 bug | 开发 | 1.5h | 1.5.4 |

**交付物**：更新后的 `TQLSlib.java`、功能正常的模组

---

#### 1.6 代码审查与测试（第 7 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 1.6.1 | 代码审查：检查单一职责原则 | 架构师 | 2.0h | 1.5 |
| 1.6.2 | 代码审查：检查模块依赖关系 | 架构师 | 2.0h | 1.6.1 |
| 1.6.3 | 静态分析：使用 IDE 检查潜在问题 | 开发 | 1.5h | 1.6.2 |
| 1.6.4 | 完整回归测试 | 测试 | 2.5h | 1.6.3 |
| 1.6.5 | 修复审查和测试发现的问题 | 开发 | 2.0h | 1.6.4 |
| 1.6.6 | 提交代码到 Git | 开发 | 0.5h | 1.6.5 |

**交付物**：代码审查报告、测试报告、阶段 1 完成的代码

---

### 阶段 1 验收标准
- ✅ 代码编译通过，无错误
- ✅ 所有现有功能正常工作
- ✅ api 包和接口定义完成
- ✅ 工具类重构完成（TQUtls → TQUtils + TimeUtils）
- ✅ SpaceStationCore 实现 SpaceStationAPI
- ✅ SpaceStationManager 重构为门面模式
- ✅ ContentRegistryCore 实现 ContentRegistry
- ✅ TQLSlib 更新完成
- ✅ 代码审查通过
- ✅ 回归测试通过

---

### 阶段 2：事件系统（第 2 周，P1）

#### 2.1 创建事件系统基础（第 8 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.1.1 | 创建 `tqlslib/event` 目录结构 | 开发 | 0.5h | 阶段 1 |
| 2.1.2 | 创建 `tqlslib/event/events` 子目录 | 开发 | 0.5h | 2.1.1 |
| 2.1.3 | 创建 `TQLEvent.java` 基类 | 开发 | 1.5h | 2.1.1 |
| 2.1.4 | 编写基类 Javadoc | 开发 | 0.5h | 2.1.3 |

**交付物**：event 包、TQLEvent 基类

---

#### 2.2 实现事件总线（第 9 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.2.1 | 创建 `EventBusImpl.java` | 开发 | 0.5h | 2.1 |
| 2.2.2 | 实现订阅（subscribe）方法 | 开发 | 1.5h | 2.2.1 |
| 2.2.3 | 实现取消订阅（unsubscribe）方法 | 开发 | 1.0h | 2.2.2 |
| 2.2.4 | 实现发布（post）方法 | 开发 | 1.5h | 2.2.3 |
| 2.2.5 | 编写 Javadoc 文档 | 开发 | 1.0h | 2.2.4 |

**交付物**：EventBusImpl 实现

---

#### 2.3 定义具体事件（第 10 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.3.1 | 创建 `SpaceStationCreateEvent.java` | 开发 | 1.0h | 2.1 |
| 2.3.2 | 创建 `SpaceStationRemoveEvent.java` | 开发 | 1.0h | 2.3.1 |
| 2.3.3 | 创建 `SpaceStationRenameEvent.java` | 开发 | 1.0h | 2.3.2 |
| 2.3.4 | 为每个事件编写 Javadoc | 开发 | 1.0h | 2.3.3 |

**交付物**：3 个空间站事件类

---

#### 2.4 集成事件触发（第 11 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.4.1 | 在 `SpaceStationCore.createStation` 中触发创建事件 | 开发 | 1.5h | 2.2, 2.3 |
| 2.4.2 | 在 `SpaceStationCore.removeStation` 中触发删除事件 | 开发 | 1.0h | 2.4.1 |
| 2.4.3 | 在 `SpaceStationCore.renameStation` 中触发重命名事件 | 开发 | 1.0h | 2.4.2 |
| 2.4.4 | 添加事件总线实例到 `TQLSlib` | 开发 | 0.5h | 2.4.3 |
| 2.4.5 | 编译并修复错误 | 开发 | 1.0h | 2.4.4 |

**交付物**：集成事件触发的代码

---

#### 2.5 测试事件系统（第 12-13 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.5.1 | 编写事件系统单元测试 | 开发 | 3.0h | 2.4 |
| 2.5.2 | 运行单元测试 | 测试 | 1.0h | 2.5.1 |
| 2.5.3 | 创建测试用的事件订阅示例 | 开发 | 2.0h | 2.5.2 |
| 2.5.4 | 手动测试空间站操作的事件触发 | 测试 | 3.0h | 2.5.3 |
| 2.5.5 | 修复发现的问题 | 开发 | 2.0h | 2.5.4 |

**交付物**：单元测试、测试报告

---

#### 2.6 代码审查与提交（第 14 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 2.6.1 | 代码审查：事件系统实现 | 架构师 | 2.0h | 2.5 |
| 2.6.2 | 代码审查：事件触发集成 | 架构师 | 1.5h | 2.6.1 |
| 2.6.3 | 静态分析检查 | 开发 | 1.0h | 2.6.2 |
| 2.6.4 | 回归测试 | 测试 | 2.5h | 2.6.3 |
| 2.6.5 | 修复问题 | 开发 | 2.0h | 2.6.4 |
| 2.6.6 | 提交代码到 Git | 开发 | 0.5h | 2.6.5 |

**交付物**：代码审查报告、测试报告、阶段 2 完成的代码

---

### 阶段 2 验收标准
- ✅ 事件包结构创建完成
- ✅ TQLEvent 基类实现完成
- ✅ EventBusImpl 实现完成（subscribe、unsubscribe、post）
- ✅ 3 个空间站事件定义完成
- ✅ 空间站操作正确触发事件
- ✅ 单元测试通过
- ✅ 手动测试通过
- ✅ 代码审查通过
- ✅ 回归测试通过

---

### 阶段 3：配置系统（第 3-4 周，P1）

#### 3.1 创建配置系统基础（第 15 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.1.1 | 创建 `tqlslib/config` 目录结构 | 开发 | 0.5h | 阶段 2 |
| 3.1.2 | 创建 `tqlslib/config/parser` 子目录 | 开发 | 0.5h | 3.1.1 |
| 3.1.3 | 创建 `ConfigLoader.java` | 开发 | 2.0h | 3.1.1 |
| 3.1.4 | 实现 `loadModConfigs` 方法 | 开发 | 1.5h | 3.1.3 |
| 3.1.5 | 实现 `loadConfig` 方法框架 | 开发 | 1.0h | 3.1.4 |
| 3.1.6 | 编写 Javadoc | 开发 | 1.0h | 3.1.5 |

**交付物**：config 包、ConfigLoader 框架

---

#### 3.2 创建内容解析器抽象（第 16 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.2.1 | 创建 `ContentParser.java` 抽象基类 | 开发 | 1.0h | 3.1 |
| 3.2.2 | 定义 `parse` 抽象方法 | 开发 | 0.5h | 3.2.1 |
| 3.2.3 | 定义 `getContentType` 抽象方法 | 开发 | 0.5h | 3.2.2 |
| 3.2.4 | 实现 `validate` 工具方法 | 开发 | 1.5h | 3.2.3 |
| 3.2.5 | 编写 Javadoc | 开发 | 1.0h | 3.2.4 |

**交付物**：ContentParser 抽象基类

---

#### 3.3 实现方块解析器（第 17-18 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.3.1 | 创建 `BlockParser.java` | 开发 | 0.5h | 3.2 |
| 3.3.2 | 分析 Mindustry Block 结构 | 开发 | 2.0h | 3.3.1 |
| 3.3.3 | 定义方块 JSON 配置格式 | 开发 | 1.5h | 3.3.2 |
| 3.3.4 | 实现基本属性解析（name、description） | 开发 | 2.0h | 3.3.3 |
| 3.3.5 | 实现方块类型解析 | 开发 | 2.5h | 3.3.4 |
| 3.3.6 | 实现特殊属性解析（power、item、liquid 等） | 开发 | 3.0h | 3.3.5 |
| 3.3.7 | 编写 Javadoc | 开发 | 1.0h | 3.3.6 |
| 3.3.8 | 创建示例方块 JSON 配置 | 开发 | 1.5h | 3.3.7 |
| 3.3.9 | 测试方块解析器 | 测试 | 2.0h | 3.3.8 |

**交付物**：BlockParser、示例配置、测试报告

---

#### 3.4 实现状态效果解析器（第 19-20 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.4.1 | 创建 `StatusParser.java` | 开发 | 0.5h | 3.2 |
| 3.4.2 | 分析 Mindustry StatusEffect 结构 | 开发 | 1.5h | 3.4.1 |
| 3.4.3 | 定义状态效果 JSON 配置格式 | 开发 | 1.0h | 3.4.2 |
| 3.4.4 | 实现基本属性解析 | 开发 | 1.5h | 3.4.3 |
| 3.4.5 | 实现效果解析（damage、speed、health 等） | 开发 | 2.5h | 3.4.4 |
| 3.4.6 | 实现粒子效果解析 | 开发 | 2.0h | 3.4.5 |
| 3.4.7 | 编写 Javadoc | 开发 | 1.0h | 3.4.6 |
| 3.4.8 | 创建示例状态效果 JSON 配置 | 开发 | 1.0h | 3.4.7 |
| 3.4.9 | 测试状态效果解析器 | 测试 | 2.0h | 3.4.8 |

**交付物**：StatusParser、示例配置、测试报告

---

#### 3.5 实现星球解析器（第 21-22 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.5.1 | 创建 `PlanetParser.java` | 开发 | 0.5h | 3.2 |
| 3.5.2 | 分析 Mindustry Planet 结构 | 开发 | 1.5h | 3.5.1 |
| 3.5.3 | 定义星球 JSON 配置格式 | 开发 | 1.0h | 3.5.2 |
| 3.5.4 | 实现基本属性解析 | 开发 | 1.5h | 3.5.3 |
| 3.5.5 | 实现轨道和生成器解析 | 开发 | 2.5h | 3.5.4 |
| 3.5.6 | 编写 Javadoc | 开发 | 1.0h | 3.5.5 |
| 3.5.7 | 创建示例星球 JSON 配置 | 开发 | 1.0h | 3.5.6 |
| 3.5.8 | 测试星球解析器 | 测试 | 2.0h | 3.5.7 |

**交付物**：PlanetParser、示例配置、测试报告

---

#### 3.6 集成到加载流程（第 23 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.6.1 | 创建解析器注册表 | 开发 | 1.0h | 3.3, 3.4, 3.5 |
| 3.6.2 | 完善 `ConfigLoader.loadConfig` 实现 | 开发 | 2.0h | 3.6.1 |
| 3.6.3 | 在 `TQLSlib.loadContent` 中调用配置加载 | 开发 | 1.0h | 3.6.2 |
| 3.6.4 | 编译并修复错误 | 开发 | 1.5h | 3.6.3 |
| 3.6.5 | 测试配置加载流程 | 测试 | 2.0h | 3.6.4 |

**交付物**：集成配置系统的代码

---

#### 3.7 代码审查与测试（第 24-28 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 3.7.1 | 代码审查：ConfigLoader | 架构师 | 1.5h | 3.6 |
| 3.7.2 | 代码审查：ContentParser 及实现 | 架构师 | 2.5h | 3.7.1 |
| 3.7.3 | 静态分析检查 | 开发 | 1.5h | 3.7.2 |
| 3.7.4 | 配置系统集成测试 | 测试 | 4.0h | 3.7.3 |
| 3.7.5 | 完整回归测试 | 测试 | 3.0h | 3.7.4 |
| 3.7.6 | 修复发现的问题 | 开发 | 4.0h | 3.7.5 |
| 3.7.7 | 提交代码到 Git | 开发 | 0.5h | 3.7.6 |

**交付物**：代码审查报告、测试报告、阶段 3 完成的代码

---

### 阶段 3 验收标准
- ✅ ConfigLoader 实现完成
- ✅ ContentParser 抽象基类实现完成
- ✅ BlockParser 实现完成，可以通过 JSON 定义方块
- ✅ StatusParser 实现完成，可以通过 JSON 定义状态效果
- ✅ PlanetParser 实现完成，可以通过 JSON 定义星球
- ✅ 配置系统集成到 TQLSlib 加载流程
- ✅ 示例配置可以正常加载
- ✅ 错误处理完善
- ✅ 代码审查通过
- ✅ 回归测试通过

---

### 阶段 4：内容注册表优化（第 5 周，P2）

#### 4.1 创建注册表基础（第 29 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 4.1.1 | 创建 `tqlslib/content/registry` 目录结构 | 开发 | 0.5h | 阶段 3 |
| 4.1.2 | 创建 `ClassRegistry.java` | 开发 | 0.5h | 4.1.1 |
| 4.1.3 | 实现注册表核心数据结构 | 开发 | 1.5h | 4.1.2 |
| 4.1.4 | 实现 `register` 方法 | 开发 | 1.0h | 4.1.3 |
| 4.1.5 | 实现 `get` 方法 | 开发 | 0.5h | 4.1.4 |
| 4.1.6 | 实现 `has` 方法 | 开发 | 0.5h | 4.1.5 |
| 4.1.7 | 编写 Javadoc | 开发 | 1.0h | 4.1.6 |

**交付物**：ClassRegistry 基础实现

---

#### 4.2 迁移现有注册（第 30 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 4.2.1 | 分析 `TQLSlib` 中现有的 ClassMap 注册 | 开发 | 1.0h | 4.1 |
| 4.2.2 | 将 PowerTower 注册迁移到 ClassRegistry | 开发 | 0.5h | 4.2.1 |
| 4.2.3 | 将 ExtentionStatus 注册迁移到 ClassRegistry | 开发 | 0.5h | 4.2.2 |
| 4.2.4 | 将所有方块注册迁移到 ClassRegistry | 开发 | 1.5h | 4.2.3 |
| 4.2.5 | 更新 `TQLSlib` 使用 ClassRegistry | 开发 | 1.5h | 4.2.4 |
| 4.2.6 | 编译并修复错误 | 开发 | 1.0h | 4.2.5 |

**交付物**：迁移完成的注册逻辑

---

#### 4.3 测试注册表（第 31 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 4.3.1 | 编写 ClassRegistry 单元测试 | 开发 | 2.0h | 4.2 |
| 4.3.2 | 运行单元测试 | 测试 | 1.0h | 4.3.1 |
| 4.3.3 | 测试内容注册功能 | 测试 | 2.0h | 4.3.2 |
| 4.3.4 | 验证向后兼容性 | 测试 | 2.0h | 4.3.3 |
| 4.3.5 | 修复发现的问题 | 开发 | 1.5h | 4.3.4 |

**交付物**：单元测试、测试报告

---

#### 4.4 代码审查与提交（第 32-35 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 4.4.1 | 代码审查：ClassRegistry 实现 | 架构师 | 1.5h | 4.3 |
| 4.4.2 | 代码审查：注册逻辑迁移 | 架构师 | 1.5h | 4.4.1 |
| 4.4.3 | 静态分析检查 | 开发 | 1.0h | 4.4.2 |
| 4.4.4 | 完整回归测试 | 测试 | 3.0h | 4.4.3 |
| 4.4.5 | 修复问题 | 开发 | 2.5h | 4.4.4 |
| 4.4.6 | 提交代码到 Git | 开发 | 0.5h | 4.4.5 |

**交付物**：代码审查报告、测试报告、阶段 4 完成的代码

---

### 阶段 4 验收标准
- ✅ ClassRegistry 实现完成
- ✅ 所有现有类注册迁移到 ClassRegistry
- ✅ TQLSlib 使用 ClassRegistry 进行注册
- ✅ 单元测试通过
- ✅ 向后兼容性验证通过
- ✅ 代码审查通过
- ✅ 回归测试通过

---

### 阶段 5：文档与示例（第 6 周，P2）

#### 5.1 编写 API 文档（第 36-37 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 5.1.1 | 完善所有接口的 Javadoc | 开发 | 2.0h | 阶段 4 |
| 5.1.2 | 完善所有核心类的 Javadoc | 开发 | 3.0h | 5.1.1 |
| 5.1.3 | 完善所有工具类的 Javadoc | 开发 | 2.0h | 5.1.2 |
| 5.1.4 | 生成 Javadoc HTML | 开发 | 1.0h | 5.1.3 |
| 5.1.5 | 检查 Javadoc 完整性 | 架构师 | 2.0h | 5.1.4 |

**交付物**：完整的 Javadoc 文档

---

#### 5.2 编写使用指南（第 38 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 5.2.1 | 编写快速开始指南 | 文档 | 2.0h | 5.1 |
| 5.2.2 | 编写 API 使用指南 | 文档 | 3.0h | 5.2.1 |
| 5.2.3 | 编写 JSON 配置指南 | 文档 | 3.0h | 5.2.2 |
| 5.2.4 | 编写事件系统使用指南 | 文档 | 2.0h | 5.2.3 |
| 5.2.5 | 技术审查文档 | 架构师 | 1.5h | 5.2.4 |

**交付物**：使用指南文档

---

#### 5.3 创建示例模组（第 39-40 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 5.3.1 | 创建示例模组项目结构 | 开发 | 1.0h | 5.2 |
| 5.3.2 | 实现 API 使用示例 | 开发 | 2.0h | 5.3.1 |
| 5.3.3 | 创建 JSON 方块配置示例 | 开发 | 1.5h | 5.3.2 |
| 5.3.4 | 创建 JSON 状态效果配置示例 | 开发 | 1.5h | 5.3.3 |
| 5.3.5 | 实现事件订阅示例 | 开发 | 2.0h | 5.3.4 |
| 5.3.6 | 编写示例说明文档 | 文档 | 1.5h | 5.3.5 |
| 5.3.7 | 测试示例模组 | 测试 | 2.5h | 5.3.6 |

**交付物**：示例模组、示例说明文档

---

#### 5.4 最终测试与发布准备（第 41-42 天）
| 任务 | 详细内容 | 负责人 | 预计工时 | 依赖 |
|------|---------|--------|---------|------|
| 5.4.1 | 完整集成测试 | 测试 | 4.0h | 5.3 |
| 5.4.2 | 性能基准测试 | 测试 | 3.0h | 5.4.1 |
| 5.4.3 | 最终代码审查 | 架构师 | 2.5h | 5.4.2 |
| 5.4.4 | 修复所有发现的问题 | 开发 | 4.0h | 5.4.3 |
| 5.4.5 | 准备发布说明 | 文档 | 2.0h | 5.4.4 |
| 5.4.6 | 合并到主分支 | 开发 | 1.0h | 5.4.5 |
| 5.4.7 | 创建发布标签 | 开发 | 0.5h | 5.4.6 |

**交付物**：最终测试报告、发布说明、发布版本

---

### 阶段 5 验收标准
- ✅ Javadoc 文档完整
- ✅ 使用指南清晰完整
- ✅ 示例模组可运行
- ✅ 集成测试通过
- ✅ 性能测试通过（不低于重构前）
- ✅ 最终代码审查通过
- ✅ 所有功能正常工作

---

## 三、资源分配方案

### 3.1 人力资源

| 角色 | 人数 | 主要职责 | 阶段参与 |
|------|------|---------|---------|
| **架构师** | 1 | 架构设计、代码审查、技术决策 | 全部阶段 |
| **开发工程师** | 2 | 代码实现、单元测试、Bug 修复 | 全部阶段 |
| **测试工程师** | 1 | 测试计划、测试执行、测试报告 | 全部阶段 |
| **文档工程师** | 1 | 文档编写、文档审查 | 阶段 5 为主 |

### 3.2 人力资源分配（按阶段）

#### 阶段 1：架构基础与重构（第 1 周）
| 角色 | 工时（人天） | 主要任务 |
|------|-------------|---------|
| 架构师 | 1.0 | 代码审查 |
| 开发工程师 | 10.0 | 代码实现、编译、修复 |
| 测试工程师 | 2.0 | 功能测试、回归测试 |
| 文档工程师 | 0.5 | 记录变更 |
| **总计** | **13.5** | |

#### 阶段 2：事件系统（第 2 周）
| 角色 | 工时（人天） | 主要任务 |
|------|-------------|---------|
| 架构师 | 1.0 | 代码审查 |
| 开发工程师 | 9.5 | 代码实现、单元测试 |
| 测试工程师 | 2.5 | 事件测试、回归测试 |
| 文档工程师 | 0.5 | 记录变更 |
| **总计** | **13.5** | |

#### 阶段 3：配置系统（第 3-4 周）
| 角色 | 工时（人天） | 主要任务 |
|------|-------------|---------|
| 架构师 | 2.0 | 代码审查 |
| 开发工程师 | 18.0 | 代码实现、解析器开发 |
| 测试工程师 | 4.5 | 配置测试、集成测试 |
| 文档工程师 | 1.5 | 配置格式文档 |
| **总计** | **26.0** | |

#### 阶段 4：内容注册表优化（第 5 周）
| 角色 | 工时（人天） | 主要任务 |
|------|-------------|---------|
| 架构师 | 1.0 | 代码审查 |
| 开发工程师 | 7.5 | 注册表实现、迁移 |
| 测试工程师 | 2.5 | 注册表测试、兼容性测试 |
| 文档工程师 | 0.5 | 记录变更 |
| **总计** | **11.5** | |

#### 阶段 5：文档与示例（第 6 周）
| 角色 | 工时（人天） | 主要任务 |
|------|-------------|---------|
| 架构师 | 2.0 | 文档审查、最终代码审查 |
| 开发工程师 | 7.0 | 示例模组、最终修复 |
| 测试工程师 | 3.5 | 最终测试、性能测试 |
| 文档工程师 | 6.0 | Javadoc、使用指南、发布说明 |
| **总计** | **18.5** | |

### 3.3 总人力资源统计

| 角色 | 总工时（人天） | 占比 |
|------|---------------|------|
| 架构师 | 7.0 | 9.3% |
| 开发工程师 | 52.0 | 69.3% |
| 测试工程师 | 15.0 | 20.0% |
| 文档工程师 | 9.0 | 12.0% |
| **总计** | **83.0** | **100%** |

### 3.4 硬件资源

| 资源 | 配置要求 | 数量 | 用途 |
|------|---------|------|------|
| 开发电脑 | i5+ / 16GB+ / SSD | 3 | 开发、编译 |
| 测试电脑 | i5+ / 8GB+ | 1 | 测试、验证 |
| Git 仓库 | - | 1 | 代码版本控制 |
| 文档服务器 | - | 1 | 文档托管 |

---

## 四、时间进度安排（甘特图）

### 4.1 总体进度表

| 阶段 | 开始日期 | 结束日期 | 工作日 | 里程碑 |
|------|---------|---------|--------|--------|
| 阶段 1：架构基础与重构 | 2026-02-16 | 2026-02-22 | 7 | M1 |
| 阶段 2：事件系统 | 2026-02-23 | 2026-03-01 | 7 | M2 |
| 阶段 3：配置系统 | 2026-03-02 | 2026-03-15 | 14 | M3 |
| 阶段 4：内容注册表优化 | 2026-03-16 | 2026-03-22 | 7 | M4 |
| 阶段 5：文档与示例 | 2026-03-23 | 2026-03-29 | 7 | M5 |
| **总计** | **2026-02-16** | **2026-03-29** | **42** | |

### 4.2 详细甘特图（按天）

```
日期       | 16 17 18 19 20 21 22 | 23 24 25 26 27 28 01 | 02 03 04 05 06 07 08 09 10 11 12 13 14 15 | 16 17 18 19 20 21 22 | 23 24 25 26 27 28 29
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
阶段 1     |████████████████████████|                        |                                            |                        |
  准备工作  |███                     |                        |                                            |                        |
  API 接口  |   ███                  |                        |                                            |                        |
  工具重构  |      ███               |                        |                                            |                        |
  空间站重构|         █████          |                        |                                            |                        |
  更新主入口|              █         |                        |                                            |                        |
  审查测试  |               ██       |                        |                                            |                        |
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
阶段 2     |                        |████████████████████████|                                            |                        |
  事件基础  |                        |███                     |                                            |                        |
  事件总线  |                        |   ██                   |                                            |                        |
  定义事件  |                        |      █                 |                                            |                        |
  集成触发  |                        |       █                |                                            |                        |
  测试      |                        |        ████            |                                            |                        |
  审查提交  |                        |            ██          |                                            |                        |
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
阶段 3     |                        |                        |████████████████████████████████████████████|                        |
  配置基础  |                        |                        |██                                          |                        |
  解析器抽象|                        |                        |  █                                         |                        |
  方块解析器|                        |                        |   ████                                     |                        |
  状态解析器|                        |                        |       ████                                 |                        |
  星球解析器|                        |                        |           ████                             |                        |
  集成加载  |                        |                        |               █                            |                        |
  审查测试  |                        |                        |                ███████████                  |                        |
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
阶段 4     |                        |                        |                                            |████████████████████████|
  注册表基础|                        |                        |                                            |███                     |
  迁移注册  |                        |                        |                                            |   ██                   |
  测试      |                        |                        |                                            |      ██                |
  审查提交  |                        |                        |                                            |        ████            |
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
阶段 5     |                        |                        |                                            |                        |████████████████████████
  API 文档  |                        |                        |                                            |                        |████                    |
  使用指南  |                        |                        |                                            |                        |    ██                  |
  示例模组  |                        |                        |                                            |                        |      ████              |
  最终测试  |                        |                        |                                            |                        |          ██████        |
  发布准备  |                        |                        |                                            |                        |                ██      |
-----------|------------------------|------------------------|--------------------------------------------|------------------------|------------------------
里程碑     |           M1           |           M2           |                     M3                     |           M4           |           M5
```

### 4.3 关键路径分析
- **关键路径**：阶段 1 → 阶段 2 → 阶段 3 → 阶段 4 → 阶段 5
- **最长任务**：阶段 3（配置系统），14 天
- **缓冲区**：每个阶段预留 0.5 天缓冲区
- **总浮动时间**：0 天（关键路径无浮动）

---

## 五、质量控制标准

### 5.1 代码质量标准

| 指标 | 目标值 | 测量方法 | 责任人 |
|------|--------|---------|--------|
| **代码编译** | 0 错误、0 警告 | 编译器检查 | 开发工程师 |
| **静态分析** | 无严重问题 | IDE 静态分析工具 | 开发工程师 |
| **代码审查通过率** | 100% | 架构师审查 | 架构师 |
| **单元测试覆盖率** | ≥ 80%（核心逻辑） | 测试覆盖率工具 | 测试工程师 |
| **类平均代码行数** | ≤ 150 行 | 代码统计工具 | 架构师 |
| **方法平均代码行数** | ≤ 30 行 | 代码统计工具 | 架构师 |
| **圈复杂度** | ≤ 10 | 代码复杂度分析工具 | 架构师 |

### 5.2 功能质量标准

| 指标 | 目标值 | 测量方法 | 责任人 |
|------|--------|---------|--------|
| **现有功能完整性** | 100% | 回归测试 | 测试工程师 |
| **新功能完整性** | 100% | 功能测试 | 测试工程师 |
| **Bug 修复率** | 100%（发布前） | Bug 跟踪系统 | 开发工程师 |
| **向后兼容性** | 无破坏性变更 | 兼容性测试 | 测试工程师 |

### 5.3 性能质量标准

| 指标 | 目标值 | 测量方法 | 责任人 |
|------|--------|---------|--------|
| **启动时间** | ≤ 重构前 | 性能测试 | 测试工程师 |
| **内存占用** | ≤ 重构前 + 10% | 内存分析工具 | 测试工程师 |
| **FPS（游戏内）** | ≥ 重构前 | 性能监控 | 测试工程师 |
| **事件响应延迟** | ≤ 10ms | 性能测试 | 测试工程师 |

### 5.4 文档质量标准

| 指标 | 目标值 | 测量方法 | 责任人 |
|------|--------|---------|--------|
| **Javadoc 覆盖率** | ≥ 90%（公共 API） | Javadoc 工具 | 文档工程师 |
| **使用指南完整性** | 100% | 文档审查 | 架构师 |
| **示例代码可运行性** | 100% | 示例测试 | 测试工程师 |

### 5.5 质量检查点

| 阶段 | 检查点 | 检查内容 |
|------|--------|---------|
| 阶段 1 | 代码质量检查 | 编译、静态分析、代码审查 |
| 阶段 1 | 功能质量检查 | 回归测试 |
| 阶段 2 | 代码质量检查 | 编译、静态分析、代码审查 |
| 阶段 2 | 功能质量检查 | 事件系统测试、回归测试 |
| 阶段 3 | 代码质量检查 | 编译、静态分析、代码审查 |
| 阶段 3 | 功能质量检查 | 配置系统测试、回归测试 |
| 阶段 4 | 代码质量检查 | 编译、静态分析、代码审查 |
| 阶段 4 | 功能质量检查 | 注册表测试、兼容性测试、回归测试 |
| 阶段 5 | 代码质量检查 | 最终代码审查 |
| 阶段 5 | 功能质量检查 | 最终集成测试 |
| 阶段 5 | 性能质量检查 | 性能基准测试 |
| 阶段 5 | 文档质量检查 | 文档审查 |

---

## 六、风险评估与应对措施

### 6.1 风险登记册

| 风险 ID | 风险描述 | 可能性 | 影响 | 风险等级 | 触发条件 |
|---------|---------|--------|------|---------|---------|
| R01 | 重构引入现有功能 Bug | 中 | 高 | 高 | 重构后现有功能异常 |
| R02 | 事件系统性能下降 | 低 | 中 | 中 | 事件频繁触发时 FPS 下降 |
| R03 | JSON 解析复杂度过高 | 中 | 中 | 中 | 配置解析耗时过长 |
| R04 | 向后兼容性问题 | 中 | 高 | 高 | 依赖本模组的其他模组无法运行 |
| R05 | 开发进度延期 | 中 | 中 | 中 | 实际进度落后于计划 |
| R06 | 人员变动 | 低 | 高 | 中 | 核心开发人员离开 |
| R07 | 需求变更 | 低 | 高 | 中 | 架构规划中途变更 |
| R08 | 测试不充分 | 中 | 高 | 高 | 发布后发现严重 Bug |

### 6.2 风险应对措施

#### R01：重构引入现有功能 Bug
- **预防措施**：
  - 分阶段重构，每次只改一小部分
  - 充分的回归测试
  - 保留回退方案（Git 分支）
- **应对措施**：
  - 立即回退到上一个稳定版本
  - 分析 Bug 原因，修复后重新发布
- **责任人**：开发工程师、测试工程师
- **预算**：2 人天

#### R02：事件系统性能下降
- **预防措施**：
  - 事件总线实现时考虑性能优化
  - 避免在事件处理中执行耗时操作
- **应对措施**：
  - 性能分析，定位瓶颈
  - 优化热点代码
  - 考虑添加事件过滤机制
- **责任人**：开发工程师、测试工程师
- **预算**：1 人天

#### R03：JSON 解析复杂度过高
- **预防措施**：
  - 分步实现，先支持简单配置
  - 使用高效的 JSON 解析库
- **应对措施**：
  - 优化解析算法
  - 添加配置缓存
  - 支持异步加载
- **责任人**：开发工程师
- **预算**：1 人天

#### R04：向后兼容性问题
- **预防措施**：
  - 保留原有的类和方法（标记为 @Deprecated）
  - 充分的兼容性测试
- **应对措施**：
  - 发布小版本修复兼容性问题
  - 提供迁移指南
- **责任人**：架构师、测试工程师
- **预算**：1 人天

#### R05：开发进度延期
- **预防措施**：
  - 合理排期，预留缓冲时间
  - 优先级管理，先做高优先级任务
  - 每日站会，跟踪进度
- **应对措施**：
  - 调整优先级，延期低优先级任务
  - 增加资源（如果可能）
  - 缩小范围，先完成核心功能
- **责任人**：项目经理、全体成员
- **预算**：灵活调整

#### R06：人员变动
- **预防措施**：
  - 代码文档化
  - 知识共享
  - 代码审查确保多人了解代码
- **应对措施**：
  - 及时招聘补充
  - 安排知识转移
  - 调整任务分配
- **责任人**：项目经理
- **预算**：灵活调整

#### R07：需求变更
- **预防措施**：
  - 确认需求冻结
  - 变更评估流程
- **应对措施**：
  - 评估变更影响
  - 如必要，调整计划
  - 记录所有变更
- **责任人**：架构师、项目经理
- **预算**：灵活调整

#### R08：测试不充分
- **预防措施**：
  - 制定详细的测试计划
  - 充分的测试时间
  - 代码审查辅助发现问题
- **应对措施**：
  - 延长测试时间
  - 增加测试资源
  - 发布补丁版本
- **责任人**：测试工程师、开发工程师
- **预算**：1 人天

### 6.3 风险监控
- **频率**：每周一次风险评估会议
- **工具**：风险登记册
- **责任人**：项目经理
- **升级条件**：风险等级变为高或触发条件发生

---

## 七、关键里程碑设定

### 7.1 里程碑 M1：架构基础与重构（第 7 天，2026-02-22）

#### 交付物
- ✅ Git 分支 `feature/architecture-refactor`
- ✅ api 包和 3 个接口定义
- ✅ 重构后的工具类（TQUtils + TimeUtils）
- ✅ SpaceStationCore 实现
- ✅ ContentRegistryCore 实现
- ✅ 更新后的 TQLSlib
- ✅ 代码审查报告
- ✅ 测试报告

#### 验收标准
- 代码编译通过，无错误
- 所有现有功能正常工作
- 代码审查通过
- 回归测试通过

#### 责任人
- 开发工程师：代码实现
- 测试工程师：测试
- 架构师：代码审查

---

### 7.2 里程碑 M2：事件系统（第 14 天，2026-03-01）

#### 交付物
- ✅ event 包结构
- ✅ TQLEvent 基类
- ✅ EventBusImpl 实现
- ✅ 3 个空间站事件类
- ✅ 集成事件触发的代码
- ✅ 单元测试
- ✅ 代码审查报告
- ✅ 测试报告

#### 验收标准
- 事件系统正常工作
- 空间站操作正确触发事件
- 单元测试通过
- 代码审查通过
- 回归测试通过

#### 责任人
- 开发工程师：代码实现
- 测试工程师：测试
- 架构师：代码审查

---

### 7.3 里程碑 M3：配置系统（第 28 天，2026-03-15）

#### 交付物
- ✅ config 包结构
- ✅ ConfigLoader 实现
- ✅ ContentParser 抽象基类
- ✅ BlockParser 实现
- ✅ StatusParser 实现
- ✅ PlanetParser 实现
- ✅ 示例 JSON 配置
- ✅ 集成配置系统的代码
- ✅ 代码审查报告
- ✅ 测试报告

#### 验收标准
- 可以通过 JSON 定义方块
- 可以通过 JSON 定义状态效果
- 可以通过 JSON 定义星球
- 配置加载错误处理完善
- 代码审查通过
- 回归测试通过

#### 责任人
- 开发工程师：代码实现
- 测试工程师：测试
- 架构师：代码审查

---

### 7.4 里程碑 M4：内容注册表优化（第 35 天，2026-03-22）

#### 交付物
- ✅ ClassRegistry 实现
- ✅ 迁移完成的注册逻辑
- ✅ 单元测试
- ✅ 代码审查报告
- ✅ 测试报告

#### 验收标准
- 所有类注册统一管理
- 向后兼容性验证通过
- 代码审查通过
- 回归测试通过

#### 责任人
- 开发工程师：代码实现
- 测试工程师：测试
- 架构师：代码审查

---

### 7.5 里程碑 M5：文档与示例（第 42 天，2026-03-29）

#### 交付物
- ✅ 完整的 Javadoc 文档
- ✅ 使用指南
- ✅ 示例模组
- ✅ 最终测试报告
- ✅ 性能测试报告
- ✅ 发布说明
- ✅ 发布版本

#### 验收标准
- API 文档完整
- 使用指南清晰
- 示例模组可运行
- 集成测试通过
- 性能测试通过
- 最终代码审查通过
- 所有功能正常工作

#### 责任人
- 开发工程师：示例模组、最终修复
- 测试工程师：最终测试
- 文档工程师：文档
- 架构师：最终审查

---

## 八、沟通与协作计划

### 8.1 会议计划

| 会议类型 | 频率 | 参与人员 | 时长 | 主要内容 |
|---------|------|---------|------|---------|
| 每日站会 | 每个工作日 | 全体成员 | 15 分钟 | 进度同步、问题讨论 |
| 周例会 | 每周一 | 全体成员 | 1 小时 | 上周总结、本周计划、风险评估 |
| 技术评审会 | 每个阶段结束 | 架构师、开发、测试 | 2 小时 | 代码审查、技术讨论 |
| 里程碑评审会 | 每个里程碑 | 全体成员、利益相关方 | 1 小时 | 里程碑验收、下一阶段规划 |

### 8.2 沟通工具

| 工具 | 用途 |
|------|------|
| Git | 代码版本控制 |
| 项目管理工具 | 任务跟踪、进度管理 |
| 即时通讯工具 | 日常沟通 |
| 视频会议工具 | 远程会议 |
| 文档共享工具 | 文档协作 |

### 8.3 文档管理

| 文档类型 | 负责人 | 更新频率 | 存储位置 |
|---------|--------|---------|---------|
| 架构规划文档 | 架构师 | 按需 | Git 仓库 |
| 实施计划 | 项目经理 | 每周 | Git 仓库 |
| 代码审查报告 | 架构师 | 每个阶段 | Git 仓库 |
| 测试报告 | 测试工程师 | 每个阶段 | Git 仓库 |
| API 文档 | 文档工程师 | 持续 | Git 仓库 |
| 使用指南 | 文档工程师 | 阶段 5 | Git 仓库 |

---

## 九、项目成功标准

### 9.1 必须完成（硬性指标）
- ✅ 所有 5 个阶段按时完成
- ✅ 所有里程碑验收通过
- ✅ 代码符合 SOLID 原则
- ✅ 所有现有功能正常工作
- ✅ API 层完整可用
- ✅ 事件系统正常工作
- ✅ 配置系统支持 JSON
- ✅ 无严重 Bug
- ✅ 性能不低于重构前

### 9.2 期望完成（软性指标）
- 单元测试覆盖率 ≥ 80%
- 类的平均代码行数减少 30%
- 模块间耦合度降低 50%
- 文档完整且清晰
- 团队满意度高

### 9.3 业务价值
- 其他模组可以方便地使用 TQLSlib
- 可以通过 JSON 快速定义新内容
- 代码更易维护和扩展
- 模组生态更加健康

---

## 十、附录

### 10.1 术语表

| 术语 | 解释 |
|------|------|
| SOLID | 五大设计原则：SRP、OCP、LSP、ISP、DIP |
| SRP | 单一职责原则：一个类只应该有一个引起它变化的原因 |
| OCP | 开闭原则：对扩展开放，对修改关闭 |
| LSP | 里氏替换原则：子类可以替换父类 |
| ISP | 接口隔离原则：使用多个专门的接口比使用单一的总接口要好 |
| DIP | 依赖倒置原则：依赖抽象而不依赖具体实现 |
| API | 应用程序编程接口 |
| JSON | JavaScript Object Notation，一种数据交换格式 |
| Javadoc | Java 的文档生成工具 |

### 10.2 参考文档
- [架构规划详细实施计划.md](./架构规划详细实施计划.md)
- Mindustry Modding API 文档
- Java 设计模式文档

### 10.3 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| v1.0 | 2026-02-15 | 架构规划团队 | 初始版本 |

---

**文档结束**
