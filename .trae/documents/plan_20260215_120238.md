
# 确保模组兼容性的计划

## 分析出的冲突点

### 高优先级冲突
1. **ClassMap 类名冲突** - PWIntegration 中直接使用简单类名（如 "PowerTower"）注册，无模组前缀
2. **反射替换 parser** - PWIntegration 直接替换 Vars.mods 的 parser，可能破坏其他模组
3. **资源文件命名** - 需要检查 shader 和 sprite 是否有正确的模组前缀

### 中优先级冲突
4. **DTVars 初始化** - 需要确保在 TQLSlib 中正确初始化 DTVars
5. **PWIntegration 和 TranqolIntegration 的集成逻辑** - 需要添加存在性检查

## 具体修改计划

### 1. 修改 PWIntegration.java
- 为所有 ClassMap 注册的类名添加 "tqls-" 前缀
- 移除危险的 parser 反射替换逻辑，或添加安全检查
- 添加模组存在性检查

### 2. 修改 TQLSlib.java
- 在 init() 方法中添加 DTVars.init() 调用
- 添加模组初始化的安全检查
- 移除测试用的 frog 对话框（可选）

### 3. 检查资源文件
- 确保 shader 文件有正确的模组前缀
- 确保 sprite 资源命名正确

### 4. 添加兼容性检查
- 在集成模块中添加目标模组存在性检查
- 避免在目标模组不存在时执行集成代码

## 执行步骤
1. 修改 PWIntegration.java，解决 ClassMap 和 parser 冲突
2. 修改 TQLSlib.java，正确初始化 DTVars
3. 检查并确保资源文件命名安全
4. 测试验证修改后的代码
