# 空间站系统核心方法开发计划书

## 一、项目概述

### 1.1 项目目标
在tqlslib模组中实现空间站系统的核心方法和功能，支持：
- ✅ 一星球多空间站
- ✅ 独立的轨道和编号
- ✅ 完整的创建、管理、删除方法
- ✅ 持久化存储方法
- ✅ UI对话框框架
- ❌ 不构造实际的方块（只保留方法接口）

### 1.2 项目范围
- 核心数据结构和方法
- 持久化系统方法
- UI对话框框架方法
- 集成到主模组

---

## 二、开发阶段

### 阶段一：核心基础架构 ✅ 已完成
- [x] SpaceStationInfo.java - 空间站信息类
- [x] DTVars.java - 全局变量管理
- [x] SpaceStation.java - 核心空间站类（含创建和删除方法）
- [x] SpaceStationGenerator.java - 地图生成器
- [x] SpaceStationIO.java - 持久化系统（含读写方法）

### 阶段二：核心管理方法
#### 2.1 空间站管理方法
- [ ] SpaceStationManager.java - 空间站管理器类
  - `createStation(Planet parent, String name)` - 创建空间站方法
  - `removeStation(String stationId)` - 删除空间站方法
  - `renameStation(String stationId, String newName)` - 重命名方法
  - `getStationsByPlanet(Planet planet)` - 获取行星的所有空间站
  - `getStationById(String stationId)` - 根据ID获取空间站
  - `getNextStationNumber(Planet planet)` - 获取下一个编号

#### 2.2 UI对话框框架方法
- [ ] SpaceStationDialogs.java - 对话框管理类
  - `showManagerDialog()` - 显示管理对话框方法
  - `showSelectDialog(Planet planet)` - 显示选择对话框方法
  - `showCreateDialog(Planet planet)` - 显示创建对话框方法
  - `showDeleteConfirmDialog(String stationId)` - 显示删除确认对话框

### 阶段三：集成和初始化方法
#### 3.1 主模组集成
- [ ] 更新TQLSlib.java
  - `initSpaceStationSystem()` - 初始化空间站系统方法
  - `loadSpaceStations()` - 加载空间站方法
  - `saveSpaceStations()` - 保存空间站方法
  - 注册事件监听器方法

---

## 三、技术架构

### 3.1 目录结构
```
src/tqlslib/
├── type/
│   ├── SpaceStationInfo.java ✅
│   └── SpaceStation.java ✅
├── core/
│   ├── SpaceStationIO.java ✅
│   └── SpaceStationManager.java
├── ui/
│   └── SpaceStationDialogs.java
├── DTVars.java ✅
└── TQLSlib.java
```

### 3.2 核心方法流程

#### 创建空间站流程
```
用户调用 createStation(parent, name)
    ↓
生成唯一ID和编号
    ↓
创建SpaceStation对象
    ↓
添加到DTVars
    ↓
触发保存
    ↓
返回创建的空间站
```

#### 删除空间站流程
```
用户调用 removeStation(stationId)
    ↓
验证空间站存在
    ↓
从DTVars中移除
    ↓
隐藏空间站
    ↓
触发保存
    ↓
返回成功状态
```

#### 重命名空间站流程
```
用户调用 renameStation(stationId, newName)
    ↓
验证空间站存在
    ↓
更新名称
    ↓
更新本地化名称
    ↓
触发保存
    ↓
返回成功状态
```

---

## 四、文件清单

### 新增文件（共3个）
#### 核心管理类（1个）
1. `src/tqlslib/core/SpaceStationManager.java`
   - 所有空间站管理方法

#### UI对话框类（1个）
2. `src/tqlslib/ui/SpaceStationDialogs.java`
   - 所有对话框显示方法

### 修改文件（1个）
3. `src/tqlslib/TQLSlib.java`
   - 添加初始化和集成方法

---

## 五、核心方法签名

### SpaceStationManager.java
```java
public class SpaceStationManager {
    // 创建空间站
    public static SpaceStation createStation(Planet parent, String name);
    
    // 删除空间站
    public static boolean removeStation(String stationId);
    
    // 重命名空间站
    public static boolean renameStation(String stationId, String newName);
    
    // 获取行星的所有空间站
    public static Seq<SpaceStationInfo> getStationsByPlanet(Planet planet);
    
    // 根据ID获取空间站
    public static SpaceStation getStationById(String stationId);
    
    // 获取下一个编号
    public static int getNextStationNumber(Planet planet);
    
    // 检查空间站是否存在
    public static boolean stationExists(String stationId);
}
```

### SpaceStationDialogs.java
```java
public class SpaceStationDialogs {
    // 显示管理对话框
    public static void showManagerDialog();
    
    // 显示选择对话框
    public static void showSelectDialog(Planet planet, Cons<SpaceStation> callback);
    
    // 显示创建对话框
    public static void showCreateDialog(Planet planet, Cons<SpaceStation> callback);
    
    // 显示删除确认对话框
    public static void showDeleteConfirmDialog(SpaceStation station, Runnable onConfirm);
    
    // 显示重命名对话框
    public static void showRenameDialog(SpaceStation station, Cons<String> onRename);
}
```

### TQLSlib.java 新增方法
```java
// 初始化空间站系统
private void initSpaceStationSystem();

// 加载空间站
private void loadSpaceStations();

// 保存空间站
private void saveSpaceStations();
```

---

## 六、开发优先级

### P0 - 核心方法（必须）
1. SpaceStationManager.java - 所有管理方法
2. SpaceStationDialogs.java - 对话框框架方法
3. TQLSlib.java - 集成方法

---

## 七、成功标准

### 功能标准
- ✅ 可以调用方法创建多个空间站
- ✅ 可以调用方法删除空间站
- ✅ 可以调用方法重命名空间站
- ✅ 可以调用方法查询空间站
- ✅ 数据正确持久化和加载

### 质量标准
- ✅ 方法有完整的参数验证
- ✅ 方法有详细的JavaDoc注释
- ✅ 有完整的错误处理
- ✅ 有详细的日志记录

---

## 八、后续扩展方向

1. **UI实现**
   - 实现实际的对话框UI
   - 添加美观的界面

2. **方块实现**
   - 实现实际的方块类
   - 添加方块注册

3. **高级功能**
   - 空间站升级方法
   - 空间站间交互方法